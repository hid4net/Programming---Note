<h1 style="text-align:center">Windows Batch 笔记</h1>

--------------------------------------------------------------------------------
# 1. 简介
* 批处理脚本, 扩展名为`.bat`或者`.cmd`
* 包含一系列 DOS 命令, 通常用于自动执行重复性任务

--------------------------------------------------------------------------------
# 2. 基本语法

## 2.1. 基本语法
* `命令 参数 ...`
    * 命令不区分大小写
* 注释: `rem` 或 `::`
* 代码标签: `: 标签`, `:` 要在行首

## 2.2. 基本命令
| 命令  | 基本格式                      | 说明               |
| :---: | :---------------------------- | :----------------- |
| help  | help [命令]                   | 查看命令的帮助信息 |
| echo  | echo [{on &#124; off}] [信息] | 打印信息           |
|   ^   | echo=                         | 打印空行           |
|  set  | set [变量[=值]]               | 设置变量           |
| goto  | goto 标签                     | 调用 batch         |
| call  | call batch文件                | 调用 batch         |
| start | start 程序                    | 调用外部程序       |
| pause | pause                         | 暂停, 不退出       |
| exit  | exit                          | 退出               |
|  cls  | cls                           | 清屏               |
| title | title [标题]                  | 设置窗口标题       |
|  rem  | rem [注释]                    | 注释               |

## 2.3. 常用符号
|           符号            | 说明                                                     |
| :-----------------------: | :------------------------------------------------------- |
|            `@`            | 回显屏蔽                                                 |
|         &shy;`>`          | 重定向, 清除文件中原有的内容后再写入                     |
|             ^             | `>nul` 表示丢弃任何程序输出                              |
|           `>>`            | 重定向, 追加内容到文件末尾                               |
|            `<`            | 重定向, 从键盘或设备重定向命令输入                       |
|    <code>&#124;</code>    | 传递, 将前面一条命令的执行结果传递给后面一条命令继续执行 |
|         &shy;`^`          | 在特殊符号之前, 取消特殊字符的作用                       |
|            `&`            | 逻辑命令符, 无论前面的命令是否执行成功, 都执行后面的     |
|           `&&`            | 逻辑命令符, 前面的命令执行成功后, 再执行后面的命令       |
| <code>&#124;&#124;</code> | 逻辑命令符, 前面的命令没有执行成功, 则执行后面的命令     |

## 2.4. 变量
* 设置/显示变量 `SET [变量=[值字符串]]`
    * `变量` 不区分大小写
    * 不带 `=` 时, 显示变量
        * 显示所有以 `变量` 开头的变量名
    * `=` 两边不能有空格
    * `SET /A 表达式`: `=` 右边的字符串为被评估的数字表达式
    * `SET /P [变量=[输入提示字符]]`: 用户输入变量
* 获取变量: `%变量名%`
    * 可以用 `if [not] defined 变量 动作` 判断变量是否存在
* 字符串变量
    * 截取字符串: `%variable:~start,size%`
        * `start`: 正数表示从左开始, 负数表示从右开始
        * `size`: 不写的话表示到末尾
    * 替换字符串: `%variable:OldCahr=NewChar%`
    * 合并字符串: `%变量1%%变量2%`
* 变量延迟: `!变量名!`
    * 变量在使用时才读取, 多配合逻辑命令符 `&`, `&&`, `||` 使用
* 变量作用域:
    * 默认为全局变量
    * 可用 `setlocal` ... `endlocal` 限定为本地变量
* 特殊变量
    | 变量    | 说明               |
    | :------ | :----------------- |
    | `%*`    | 参数列表           |
    | `%0`    | 脚本文件名         |
    | `%1`    | 表示第一个参数     |
    | `%~1`   | 第一个参数去引号   |
    | `%~f0`  | 脚本文件完整路径名 |
    | `%~dp0` | 脚本文件所在目录   |

    </br>
* 示例
    ```batch
    rem 显示系统变量
    set
    rem 进行四则运算
    set a=1+1
    set /a b=2+1,c=3+1
    echo %a% %b% %c%
    ```
* 运算符
    |                                 运算符                                  | 说明         |
    | :---------------------------------------------------------------------: | :----------- |
    |                                  `()`                                   | 分组         |
    |                               `!` `~` `-`                               | 一元运算符   |
    |                               `*` `/` `%`                               | 算数运算符   |
    |                                 `+` `-`                                 | 算数运算符   |
    |                                `<<` `>>`                                | 逻辑移位     |
    |                       `&` <code>&#124;</code> `^`                       | 按位逻辑     |
    | `=` `*=` `/=` `%=` `+=` `-=` `&=` `^=` <code>&#124;=</code> `<<=` `>>=` | 赋值         |
    |                                   `,`                                   | 表达式分隔符 |

## 2.5. 过程
* 分支: `if ... else ...`
    ```batch
    rem 基本格式
    if [not] (字符串1 == 字符串2) (动作)
    if [not] (字符串1 == 字符串2) (动作) else (动作)
    rem 增强模式, /I 表示忽略大小写
    if /I 字符串1 比较命令 字符串2 动作
    rem 基于错误级别
    if [not] ERRORLEVEL 错误代码 动作
    rem 文件是否存在
    if [not] EXIST 文件 动作
    rem 变量是否存在
    if [not] DEFINED 变量 动作
    ```
    * 变量和字符串比较时需要转换: `"%变量名%"`
    * 判断运算符
        | 运算符 | 说明       |
        | :----: | :--------- |
        |   ==   | 等于       |
        |  EQU   | 等于       |
        | not == | 等于       |
        |  NEQ   | 不等于     |
        |  LSS   | 小于       |
        |  LEQ   | 小于或等于 |
        |  GTR   | 大于       |
        |  GEQ   | 大于或等于 |
* 循环
    ```batch
    :标签
    ....
    if ... goto 标签
    ```
    * 没有continue、break等中断, 只能通过 `goto` 跳转跳出循环

    ```batch
    rem 基本格式, 集合必须使用 ()
    FOR %变量 IN (集合) DO (动作)
    rem 通配符模式
    FOR /D %变量 IN (集合) DO (动作)
    rem 遍历路径
    FOR /R [路径] %变量 IN (集合) DO (动作)
    rem 增量模式, step 可以为负值
    FOR /L %变量 IN (start,step,end)  DO (动作)
    rem /F 模式
    FOR /F ["options"] %变量 IN (file-set) DO (动作)
    FOR /F ["options"] %变量 IN ("string") DO (动作)
    FOR /F ["options"] %变量 IN ('command') DO (动作)
    ```
    * `(集合)` 必须使用 `()`
    * 在 bat 脚本中: `%变量` 要被替换为 `%%变量`

## 2.6. 返回码和 errorlevel
* 返回码: 0 表示"成功", 1 表示"失败"
    * errorlevel 返回值可以是一个任何整型值, 一般只定义在0~255之间


## 2.7. 子程序
* 调用: `批处理文件名 参数`
* 在文件中调用: `call 批处理文件名 参数`
* 子程序的返回:
    * `goto :eof`


--------------------------------------------------------------------------------
# 3. 常用命令

## 3.2. 目录管理
|   命令   | 基本格式         | 说明                   |
| :------: | :--------------- | :--------------------- |
|    cd    | cd 路径          | 切换路径               |
|    ^     | cd /D 路径       | 切换路径, 同时切换盘符 |
|    ^     | cd               | 显示当前目录           |
| md/mkdir | md/mkdir 路径    | 创建目录               |
|    rd    | rd [目录名]      | 删除目录               |
|   dir    | dir [路径]       | 显示目录或文件列表     |
|   tree   | tree [路径]      | 显示目录结构           |
|   copy   | copy [源] [目的] | 复制文件               |
|  xcopy   | xcopy 源 [目的]  | 复制文件和目录树       |
|   move   | move [源] [目的] | 移动/重命名文件和目录  |

## 3.3. 文件管理
|  命令   | 基本格式            | 说明                  |
| :-----: | :------------------ | :-------------------- |
|  type   | type 文件           | 显示文本文件的内容    |
|  copy   | copy [源] [目的]    | 复制文件              |
|  xcopy  | xcopy 源 [目的]     | 复制文件和目录树      |
|   del   | del [文件名]        | 删除文件              |
|  move   | move [源] [目的]    | 移动/重命名文件和目录 |
|   ren   | ren 文件1 文件2     | 重命名文件            |
| replace | replace 文件1 文件2 | 替换文件              |
| attrib  | attrib 文件         | 显示或更改文件属性    |
|  find   | find 文件           | 查找文件              |

## 3.4. 系统管理
|   命令   | 基本格式 | 说明         |
| :------: | :------- | :----------- |
| shutdown | shutdown | 关闭或注销   |
|   ver    | ver      | 显示系统版本 |

## 3.5. 日期与时间
| 命令  | 基本格式 | 说明             |
| :---: | :------- | :--------------- |
| date  | date     | 获取当前系统时间 |
| time  | time     | 设置或显示时间   |

