<h1 style="text-align:center">Linux Bash 笔记</h1>

--------------------------------------------------------------------------------
# 1. 简介
* Shell
    * 用户使用 Linux 的桥梁
    * 是一种命令语言, 又是一种程序设计语言
* Shell script
    * 是一种为 shell 编写的脚本程序
* Bash (Bourne Again Shell) 是一个 Shell 程序
    * 由于其易用和免费的特性, 在日常工作中被广泛使用
    * Bash 也是多数 Linux 系统默认的 Shell

--------------------------------------------------------------------------------
# 2. 基本语法

## 2.1. 基本语法
* 基本格式
    * `命令 [参数 ...]`
    * `命令 -单字符选项 [选项参数] [参数 ...]`
        * `命令 -单字符选项组合 [选项参数] [参数 ...]`
    * `命令 --选项全名 [选项参数] [参数 ...]`
* 命令区分大小写
* 注释:
    * 单行注释: `#` 开头
    * 多行注释
        * 方式 1: `<< 标签` 和 `标签` 之间
        * 方式 2: `:<< 标签` 和 `标签` 之间
        * 方式 3: `: '` (注意: 中间有空格) 和 `'` 之间

## 2.2. 基本命令
|  命令  | 基本格式               | 说明                 |
| :----: | :--------------------- | :------------------- |
|  help  | help [命令]            | 查看命令的帮助信息   |
|  echo  | echo [信息]            | 打印信息             |
|   ^    | echo -e [信息]         | 开启转义符           |
| printf | printf 格式字符串 参数 | 类似 c 语言的 printf |
|  test  | test 条件              | 检查某个条件是否成立 |
| clear  | clear                  | 清屏                 |
|  grep  | grep 类型              | 查找字符串           |
|  expr  | expr 表达式            | 运算                 |
|  exit  | exit                   | 退出                 |

## 2.3. 常用符号
|           符号            | 说明                                                     |
| :-----------------------: | :------------------------------------------------------- |
|       命令 `>` 文件       | 将输出重定向到文件                                       |
|    命令 `> /dev/null`     | 不希望在屏幕上显示                                       |
|  命令 `> /dev/null 2>&1`  | 屏蔽 stdout 和 stderr                                    |
|       命令 `<` 文件       | 将输入重定向到文件                                       |
|      命令 `>>` 文件       | 将输出追加到文件                                         |
|        n `>` 文件         | 将文件描述符为 n 的文件重定向到文件                      |
|        n `>>` 文件        | 将文件描述符为 n 的文件以追加的方式重定向到文件          |
|         n `>&` m          | 将输出文件 m 和 n 合并                                   |
|         n `<&` m          | 将输入文件 m 和 n 合并                                   |
|    `<<` 标签 ... 标签     | 将两个标签之间的内容作为输入                             |
|    <code>&#124;</code>    | 传递, 将前面一条命令的执行结果传递给后面一条命令继续执行 |
|            `&`            | 逻辑命令符, 无论前面的命令是否执行成功, 都执行后面的     |
|           `&&`            | 逻辑命令符, 前面的命令执行成功后, 再执行后面的命令       |
| <code>&#124;&#124;</code> | 逻辑命令符, 前面的命令没有执行成功, 则执行后面的命令     |
|            `:`            | 空命令, 也可当注释用                                     |
|            `;`            | 分隔命令                                                 |

## 2.4. 变量
* 变量
    * 一个容器, 用于临时存储数据 (整数、浮点数、字符串等类任意类型的数据)
    * 无数据类型, 内部自动匹配
    * 变量名
        * 以字母和下划线开头, 可包含字母、数字、下划线
        * 区分大小写
* 设置变量
    * `变量名=值`, ==等号两边不能有空格==
    * 从用户输入初始化变量: `read 变量`
        * 参数 `-p 提示`: 用户在新的命令提示符下输入
        * 参数 `-s`: 用户将输入保持在静默模式
        * 参数 `-a`: 数组进行多个输入
            ```sh
            echo "Enter names : "
            read -a names
            echo "The entered names are : ${names[0]}, ${names[1]}."
            ```
    * 只读变量: `readonly 已声明的变量`
* 获取变量:
    * `$变量` 或 `${变量}`
    * 转为字符串: `'$变量'` 或 `"$变量"`
* 删除变量: `unset 变量`
* 特殊变量
    * 系统变量 `set`, `env`
    * 命令行变量
        | 变量 | 说明                      |
        | :--- | :------------------------ |
        | `$0` | 脚本文件名                |
        | `$1` | 表示第一个参数            |
        | `$#` | 参数个数                  |
        | `$*` | 参数列表                  |
        | `$@` | 参数数组                  |
        | `$?` | 退出状态                  |
        | `$$` | 当前脚本的进程 ID         |
        | `$!` | 显示最后一个后台作业的 ID |
* 命令替换
    * ``` `命令` ```
    * `$(命令)`
* 双括号表达式: `$((表达式))`
    ```sh
    # 示例 1
    Num=$((5+3))
    echo "Num = $Num"
    # 示例 2
    ((Num=5+3))
    echo "Num = $Num"
    # 示例 3
    Num1=5
    Num2=3
    ((Num3=Num1+Num2))
    echo "Num3 = $Num3"
    # 示例 4
    Num1=5
    Num2=3
    Num3=$((Num1+Num2))
    echo "Num3 = $Num3"
    ```
* 花括号扩展
    ```sh
    {A,B}       # 等效于 A B
    {A,B}.js    # 等效于 A.js B.js
    {1..5}      # 等效于 1 2 3 4 5
    ```
* 数组变量
    * bash 支持一维数组, 不支持多维
    * 定义数组:
        * 方式 1: `数组名=(值1 值2 ... 值n)`
        * 方式 2: `数组名[索引]=值`
    * 读取数组变量: `${数组名[索引]}`
        * 索引为负数时, 表示倒数第 n 个
        * 索引为 `*` 时, 表示所有元素
        * 索引为 `@` 时, 表示所有元素
    * 获取数组元素长度:
        * 方式 1: `${#数组名[@]}`
        * 方式 2: `${#数组名[*]}`
    * 获取某个数组元素的长度: `${#数组名[某个索引]}`
    * 数组追加元素
        * 方式 1: ``数组名=("$数组名[@]" 元素)``
        * 方式 2: `数组名+=(元素)`
    * 删除元素 `unset 数组名[索引]`
    * 合并数组 `新数组=("$数组1[@]" "$数组2[@]")`
* 字典
    * 配合 `declare -A 字典名`

## 2.5. 字符串
* 一对单引号 `'` 或一对双引号 `"` 之内的字符
* 单引号字符串的限制:
    * 任何字符都会原样输出, 其中的变量是无效的;
    * 不能出现单独一个的单引号 (对单引号使用转义符后也不行), 但可成对出现, 作为字符串拼接使用
* 转义符
    | 转义符 | 说明             |
    | :----- | :--------------- |
    | \\"    | "                |
    | \a     | 响铃             |
    | \b     | backspace        |
    | \c     | 不换行           |
    | \e     | escape character |
    | \E     | escape character |
    | \f     | form feed        |
    | \n     | new line         |
    | \r     | carriage return  |
    | \t     | horizontal tab   |
    | \v     | vertical tab     |
    | \\\\   | backslash        |
    | \0nnn  | 八进制           |
    | \xHH   | 十六进制         |
    | \uHHHH | Unicode          |
* 拼接字符串
    * 双引号拼接: `"` `字符串1` `$变量` `字符串2` ... `"`
        * 即其中的变量会被替换
    * 单引号拼接: `'字符串1'` `$变量` `'字符串2'` ...
        * 单引号中变量不会被替换, 因此每个字符串都要用成对的单引号包裹, 而变量不能用单引号包裹
* 获取字符串长度: `${#字符串变量}`
    * 变量为数组时, `${#字符串变量}` 等价于 `${#字符串变量[0]}`
* 提取字符串: `${字符串变量:位置:长度}`
    * 索引从 0 开始
    * `位置` 可以为负数, 表示从右往左数的第几个
        * 可以省略, 表示从 0 开始
    * `长度` 如果是负数, 表示到倒数第几个
        * 可以省略, 表示到末尾
* 删除与替换
    ```sh
    ${变量%后缀}        # 删除后缀
    ${变量#前缀}        # 删除前缀
    ${变量%%后缀}       # 去除长后缀
    ${变量##前缀}       # 删除长前缀
    ${变量/from/to}     # 替换第一个
    ${变量//from/to}    # 全部替换
    ${变量/%from/to}    # 替换后缀
    ${变量/#from/to}    # 替换前缀
    ```
    ```sh
    # 示例
    echo "${0%/*}"          # 脚本所在目录
    echo `dirname $0`       # 脚本所在目录
    STR="/path/to/foo.cpp"
    echo ${STR%.cpp}        # /path/to/foo
    echo ${STR%.cpp}.o      # /path/to/foo.o
    echo ${STR%/*}          # /path/to
    echo ${STR##*.}         # cpp
    echo ${STR##*/}         # foo.cpp
    echo ${STR#*/}          # path/to/foo.cpp
    echo ${STR/foo/bar}     # /path/to/bar.cpp
    ```
* 转换
    ```sh
    STR="HELLO WORLD!"
    echo ${STR,}   # => hELLO WORLD!
    echo ${STR,,}  # => hello world!

    STR="hello world!"
    echo ${STR^}   # => Hello world!
    echo ${STR^^}  # => HELLO WORLD!

    ARR=(hello World)
    echo "${ARR[@],}" # => hello world
    echo "${ARR[@]^}" # => Hello World
    ```

## 2.6. 运算符
* 算术运算符
    | 运算符 | 说明                     | 举例           |
    | :----: | :----------------------- | :------------- |
    |   +    | 加                       | `expr $a + $b` |
    |   -    | 减                       | `expr $a - $b` |
    |   *    | 乘                       | `expr $a * $b` |
    |   /    | 除                       | `expr $b / $a` |
    |   %    | 取余                     | `expr $b % $a` |
    |   =    | 赋值                     | `a=$b`         |
    |   ==   | 相等? 用于比较两个数字   | `[ $a == $b ]` |
    |   !=   | 不相等? 用于比较两个数字 | `[ $a != $b ]` |
* 关系运算符: 只支持数字, 不支持字符串, 除非字符串的值是数字
    | 运算符 | 说明   | 举例            |
    | :----: | :----- | :-------------- |
    |  -eq   | ==     | `[ $a -eq $b ]` |
    |  -ne   | !=     | `[ $a -ne $b ]` |
    |  -gt   | &shy;> | `[ $a -gt $b ]` |
    |  -lt   | <      | `[ $a -lt $b ]` |
    |  -ge   | >=     | `[ $a -ge $b ]` |
    |  -le   | <=     | `[ $a -le $b ]` |
* 布尔运算符
    | 运算符 | 说明 | 举例                          |
    | :----: | :--- | :---------------------------- |
    |   !    | not  | `[ ! false ]`                 |
    |   -a   | and  | `[ $a -lt 20 -a $b -gt 100 ]` |
    |   -o   | or   | `[ $a -lt 20 -o $b -gt 100 ]` |
* 逻辑运算符
    |    运算符    | 说明 | 举例                               |
    | :----------: | :--- | :--------------------------------- |
    |      &&      | AND  | \[[ \$a -lt 100 && $b -gt 100 ]]   |
    | &#124;&#124; | OR   | \[[ \$a -lt 100 \|\| $b -gt 100 ]] |
* 字符串运算符
    | 运算符 | 说明                 | 举例           |
    | :----: | :------------------- | :------------- |
    |   =    | 两个字符串是否相等   | `[ $a = $b ]`  |
    |   !=   | 两个字符串是否不相等 | `[ $a != $b ]` |
    |   -z   | 字符串长度是否为0    | `[ -z $a ]`    |
    |   -n   | 字符串长度是否不为 0 | `[ -n "$a" ]`  |
    |   $    | 字符串是否不为空     | `[ $a ]`       |
* 文件测试运算符
    | 操作符  | 说明                                | 举例           |
    | :-----: | :---------------------------------- | :------------- |
    | -b file | 是否是块设备文件                    | `[ -b $file ]` |
    | -c file | 是否是字符设备文件                  | `[ -c $file ]` |
    | -d file | 是否是目录                          | `[ -d $file ]` |
    | -f file | 是否是普通文件 (非目录, 非设备文件) | `[ -f $file ]` |
    | -g file | 文件是否设置了 SGID 位              | `[ -g $file ]` |
    | -k file | 文件是否设置了粘着位(Sticky Bit)    | `[ -k $file ]` |
    | -p file | 文件是否是有名管道                  | `[ -p $file ]` |
    | -u file | 文件是否设置了 SUID 位              | `[ -u $file ]` |
    | -r file | 文件是否可读                        | `[ -r $file ]` |
    | -w file | 文件是否可写                        | `[ -w $file ]` |
    | -x file | 文件是否可执行                      | `[ -x $file ]` |
    | -s file | 文件是否为空 (文件大小是否大于0)    | `[ -s $file ]` |
    | -e file | 文件 (包括目录) 是否存在            | `[ -e $file ]` |

## 2.7. 过程
### 2.7.1. 分支
* `if` 分支
    ```sh
    if 条件;
    then
        动作
    elif 条件
    then
        动作
    else
        动作
    fi
    ```
    * `then:` 表示什么都不做
    * 不能出现无动作的 `else`
    * 条件
        * 方式 1: `[ 条件 ]`, 其中的运算符是标准运算符
        * 方式 2: `(( 条件 ))`, 其中的运算符可以是 `<` `>` `>=` `<=`
* `case` 分支
    ```sh
    case 表达式 in
        模式_1)
            statements
            ;;
        模式_2)
            statements
            ;;
        模式_3|模式_4|模式_5)
            statements
            ;;
        模式-n)
            statements
            ;;
        *)
            statements
            ;;
    esac
    ```
    * `|` 连接多个模式
    * 模式后跟随 `)`
    * `;;` 类似于 break
    * `*` 类似于 default

### 2.7.2. 循环
* `for` 循环
    ```sh
    for 变量 in 列表
    do
        动作
    done
    ```
    * 列表可以是: `值1 值2 ... 值n`
    * 列表也可以是 `起始值..结束值..增量`
    * 列表也可以是数组变量 `${数组名[@]}`
        <br/>
    ```sh
    for ((表达式_1; 表达式_2; 表达式_3))
    do
        动作
    done
    ```
    * 类似于 C 语言的 for 循环
* `while` 循环
    ```sh
    while 条件;
    do
        动作
    done
    ```
* `until` 循环
    ```sh
    until 条件;
    do
        动作
    done
    ```
* 无限循环
    ```sh
    # 无限循环
    while :
    do
        动作
    done
    # 无限循环
    while true
    do
        动作
    done
    # 无限循环
    for (( ; ;))
    do
        动作
    done
    ```
* 支持 `break` `continue`

## 2.8. 函数
* 声明
    ```sh
    # 完整格式
    function 函数名 () {
        动作;
        return 整数;
    }
    # function 关键词可省略
    函数名 () {
        动作;
        return 整数;
    }
    # 参数列表也可省略
    函数名 {
        动作;
        return 整数;
    }
    # 可以不带返回值
    函数名 {
        动作;
    }
    ```
    * 返回值只能是 $[0, 255]$ 区间的整数
* 调用
    ```sh
    函数名 [参数]
    ```

## 2.9. 文件包含
```sh
# 方式 1
. filename   # 注意点号(.)和文件名中间有一空格
# 方式 2
source filename
```

--------------------------------------------------------------------------------
# 3. Linux 常用命令

## 3.1. 目录管理
|   命令    | 基本格式       | 说明               |
| :-------: | :------------- | :----------------- |
|    cd     | cd 路径        | 切换路径           |
|     ^     | cd /           | 切换到根目录       |
|     ^     | cd ~           | 切换到当前用户目录 |
|    ls     | ls [路径]      | 显示目录或文件列表 |
|    pwd    | pwd            | 显示当前目录       |
|   mkdir   | mkdir 路径     | 创建目录           |
|    rm     | rm 路径        | 删除文件或目录     |
|   rmdir   | rmdir [目录名] | 删除空目录         |
|   lndir   | lndir 源 目的  | 链接目录           |

## 3.2. 文件管理
|  命令   | 基本格式        | 说明                                       |
| :-----: | :-------------- | :----------------------------------------- |
|  touch  | touch 路径      | 修改文件或目录的时间属性, 如果不存在则创建 |
|   rm    | rm 路径         | 删除文件或目录                             |
|   cp    | cp 源 目的      | 复制文件和目录                             |
|   mv    | mv 源 目的      | 移动/重命名文件和目录                      |
|   ln    | ln 源 目的      | 链接文件                                   |
|   cat   | cat 文件        | 查看文档                                   |
| chattr  | chattr 路径     | 修改文件或目录属性                         |
|  chmod  | chmod 权限 文件 | 修改文件权限                               |
|  find   | find 文件       | 查找文件                                   |
|  which  | which 文件      | 查找文件                                   |
| whereis | whereis 文件    | 查找文件                                   |

## 3.3. 系统管理
| 命令  | 基本格式       | 说明       |
| :---: | :------------- | :--------- |
| exit  | exit           | 退出 shell |
| sleep | sleep 时间     | 延时       |
| kill  | kill pid或任务 | 结束进程   |

## 3.4. 日期与时间
| 命令  | 基本格式  | 说明               |
| :---: | :-------- | :----------------- |
| date  | date      | 显示或设置系统时间 |
| time  | time 管道 | 计算程序运行时间   |